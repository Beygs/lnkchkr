var _File_instances,_File_getContent,_File_findLinks,_File_checkLink,__awaiter=this&&this.__awaiter||function(t,l,c,o){return new(c=c||Promise)(function(i,e){function n(t){try{a(o.next(t))}catch(t){e(t)}}function s(t){try{a(o.throw(t))}catch(t){e(t)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof c?e:new c(function(t){t(e)})).then(n,s)}a((o=o.apply(t,l||[])).next())})},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t===e&&n:e.has(t))return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t);throw new TypeError("Cannot read private member from an object whose class did not declare it")};import chalk from"chalk";import{readFileSync,writeFileSync}from"fs";import fetch from"node-fetch";class File{constructor(t,e){this.path=t,this.mark=e,_File_instances.add(this),this.content=__classPrivateFieldGet(this,_File_instances,"m",_File_getContent).call(this),this.links=[],this.deadLinks={file:t,deadLinks:[]},__classPrivateFieldGet(this,_File_instances,"m",_File_findLinks).call(this)}checkLinks(){return __awaiter(this,void 0,void 0,function*(){console.log(`
‚è≥ Analyzing `+chalk.green(this.path));for(const t of this.links)yield __classPrivateFieldGet(this,_File_instances,"m",_File_checkLink).call(this,t);return console.log(`‚úîÔ∏è ${chalk.green(this.path)} analyzed.`),0===this.deadLinks.deadLinks.length&&console.log(`üéâ No dead link found in file ${chalk.green(this.path)}!`),this.mark&&0<this.deadLinks.deadLinks.length&&writeFileSync(this.path,this.content),this.deadLinks})}}_File_instances=new WeakSet,_File_getContent=function(){return readFileSync(this.path,{encoding:"utf8"})},_File_findLinks=function(){this.links=[...this.content.matchAll(/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9]{1,6}\b([-a-zA-Z0-9!@:%_\+.~#?&\/\/=]*)/gm)]},_File_checkLink=function(t){return __awaiter(this,void 0,void 0,function*(){try{const e=yield fetch(t[0]);200!==e.status&&(console.log(`üíÄ Dead link found in file ${chalk.green(this.path)}: ${chalk.blue(t[0])} (status ${chalk.yellow(e.status)})`),this.deadLinks.deadLinks.push({url:t[0],status:e.status}),this.mark)&&(this.content=this.content.replace(t[0],t=>`<!---lnkchkr-deadlink-${e.status}-->`+t))}catch(t){console.log(t)}})};export default File;